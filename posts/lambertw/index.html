<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <meta name="author" content="Pascal Getreuer" />
  <title>Lambert W Function Implementation</title>
  <style type="text/css">code{white-space: pre;}</style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
<link rel="stylesheet" href="../../site.css" type="text/css" />
<link rel="icon" href="../../favicon.ico" type="image/x-icon" />
<link href="https://fonts.googleapis.com/css?family=Noto+Serif+SC" rel="stylesheet" />
<script type="text/javascript" src="../../site.js" ></script>
  <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_CHTML-full" type="text/javascript"></script>
</head>
<body>

<div id="content">

<div id="navbar">
  <a href="../../index.html">&blacktriangle; Home</a>
  <a href="../../papers/index.html">&blacksquare; Papers</a>
  <a href="../../posts/index.html">&blacksquare; Posts</a>
  <a href="../../cv/index.html">&blacksquare; CV</a>
</div>

<div id="header">
<h1 class="title">Lambert W Function Implementation</h1>
<h2 class="author">Pascal Getreuer</h2>
</div>
<div class="features">
<p>
<a href="lambertw.zip">Download</a>
</p>
</div>
<div style="clear: both">
 
</div>
<p>The Matlab function <code>lambertw</code> included in this package is a self-contained M-function implementing the Lambert W function, also known as the Ω function or “product log.” It is equivalent to the numerical mode of the Symbolic Math Toolbox’s lambertw, however, no toolboxes are required to use this function.</p>
<h2 id="license-bsd">License (BSD)</h2>
<div style="font-size: 90%">
<p>Copyright © 2006, Pascal Getreuer<br> All rights reserved.</p>
<p>Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:</p>
<ul>
<li>Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.</li>
<li>Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.</li>
</ul>
<p>THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS “AS IS” AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</p>
</div>
<h2 id="function-use">Function Use</h2>
<p><code>w = lambertw(z)</code> computes the principal value of the Lambert W function, <span class="math inline">\(W_0\)</span>. The input <code>z</code> may be a complex scalar or array. For real <code>z</code>, the result is real on the principal branch for <code>z</code> ≥ −1/e.</p>
<p><code>w = lambertw(b,z)</code> specifies which branch of the Lambert W function to compute. If <code>z</code> is an array, <code>b</code> may be either an integer array of the same size as <code>z</code> or an integer scalar. If <code>z</code> is a scalar, <code>b</code> may be an array of any size.</p>
<h2 id="background">Background</h2>
<p>The Lambert W function is defined as the function W(z) such that</p>
<p><span class="math display">\[ W(z) \mathrm{e}^{W(z)} = z \]</span></p>
<p>for all complex values z. As log z is the inverse of e<sup>z</sup>, W(z) is the inverse of z e<sup>z</sup>. Like the complex logarithm, the Lambert W function is multivalued with a countably infinite number of branches. The branches are enumerated by the integers and are conventionally denoted by <span class="math inline">\(W_k\)</span> for the kth branch.</p>
<p>The principal branch, <span class="math inline">\(W_0(z)\)</span>, is real-valued for −1/e ≤ z. If −1/e ≤ z &lt; 0, then the branch <span class="math inline">\(W_{-1}(z)\)</span> is also real-valued. In the complex plane, a surface plot of <span class="math inline">\(|W_0(z)|\)</span> is</p>
<div style="float: right">
<p>
<img src="lambertw_01.png" width="358" height="353" alt="">
</p>
</div>
<div style="float: left; width: 18em">
<div class="sourceCode" id="cb1"><pre class="sourceCode matlab"><code class="sourceCode matlab"><a class="sourceLine" id="cb1-1" title="1">x = linspace(-<span class="fl">6</span>,<span class="fl">6</span>,<span class="fl">51</span>);</a>
<a class="sourceLine" id="cb1-2" title="2">y = linspace(-<span class="fl">6</span>,<span class="fl">6</span>,<span class="fl">51</span>);</a>
<a class="sourceLine" id="cb1-3" title="3">[x,y] = meshgrid(x,y);</a>
<a class="sourceLine" id="cb1-4" title="4">w = lambertw(x + i*y);</a>
<a class="sourceLine" id="cb1-5" title="5"></a>
<a class="sourceLine" id="cb1-6" title="6">surf(x,y,abs(w));</a>
<a class="sourceLine" id="cb1-7" title="7">axis([-<span class="fl">6</span>,<span class="fl">6</span>,-<span class="fl">6</span>,<span class="fl">6</span>,<span class="fl">0</span>,<span class="fl">2.5</span>]);</a>
<a class="sourceLine" id="cb1-8" title="8">view(<span class="fl">40</span>,<span class="fl">32</span>);</a>
<a class="sourceLine" id="cb1-9" title="9">xlabel(<span class="st">&#39;Re z&#39;</span>);</a>
<a class="sourceLine" id="cb1-10" title="10">ylabel(<span class="st">&#39;Im z&#39;</span>);</a>
<a class="sourceLine" id="cb1-11" title="11">title(<span class="st">&#39;|W_0(z)|&#39;</span>);</a></code></pre></div>
</div>
<div style="clear: both">
 
</div>
<h2 id="algebra-with-the-lambert-w-function">Algebra with the Lambert W Function</h2>
<p>Although the Lambert W function may not be so widely known as the inverse trigonometry functions, it has essentially the same purpose as acos, asin, etc. as a building-block tool for solving equations. Generally, the goal is to manipulate all occurrences of the unknown variable x into an expression of the form <span class="math inline">\(f(x) \mathrm{e}^{f(x)}\)</span>, and then apply the Lambert W function.</p>
<p><strong>Problem 1.</strong> Solve <span class="math inline">\(y = (x − 1) \mathrm{e}^{2x}\)</span> for x.</p>
<p><em>Solution:</em> The right-hand side is close to the necessary form <span class="math inline">\(f(x)\mathrm{e}^{f(x)}\)</span>, but some manipulation is necessary to change the factor <span class="math inline">\((x - 1)\)</span> and the exponent 2x into the same expression. Multiplying both sides by 2,</p>
<p><span class="math display">\[2y = (2x - 2) \mathrm{e}^{2x}.\]</span></p>
<p>This form is closer, the exponent is only missing the −2. Multiplying both sides by e<sup>−2</sup> gets the desired form,</p>
<p><span class="math display">\[2\mathrm{e}^{-2}y = (2x - 2) \mathrm{e}^{2x-2}.\]</span></p>
<p>Now we can apply the Lambert W function to get</p>
<p><span class="math display">\[W(2\mathrm{e}^{-2}y) = 2x - 2,\]</span></p>
<p>which rearranges to the solution <span class="math inline">\(x = W(2\mathrm{e}^{-2} y)/2 + 1\)</span>. Note that since W is multivalued, the solution is multivalued; there are multiple values of x satisfying the equation.</p>
<p><strong>Problem 2.</strong> Solve <span class="math inline">\(b^x = x^\alpha\)</span> for x.</p>
<p><em>Solution:</em> There is initially no visible instance of the exponential function, but rewrite <span class="math inline">\(b^x\)</span> as <span class="math inline">\(\mathrm{e}^{x \log b}\)</span> to reveal <span class="math display">\[\begin{align}
\mathrm{e}^{x\log b} &amp;= x^\alpha \\
\mathrm{e}^{x(\log b) / \alpha} &amp;= x.
\end{align}\]</span></p>
<p>Now divide the exponential over to the right-hand side and multiply by <span class="math inline">\(-(\log b)/\alpha\)</span>:</p>
<p><span class="math display">\[\begin{align}
1 &amp;= x \mathrm{e}^{-x (\log b)/\alpha} \\
-(\log b)/\alpha &amp;= (-x (\log b)/\alpha) \mathrm{e}^{-x (\log b)/\alpha}.
\end{align}\]</span></p>
<p>The right-hand side is now in the form <span class="math inline">\(f(x)\mathrm{e}^{f(x)}\)</span> where the Lambert W function can be applied:</p>
<p><span class="math display">\[W\bigl(-(\log b)/\alpha\bigr) = -x (\log b)/\alpha. \]</span></p>
<p>The solution is <span class="math inline">\(x = -(\alpha / \log b) W\bigl(-(\log b)/\alpha\bigr)\)</span>.</p>
<p><strong>Problem 3.</strong> An old result [1] is the closed-form expression for iterated exponentiation:</p>
<p><span class="math display">\[z^{z^{z^\cdots}} = \frac{W(-\log z)}{-\log z}.\]</span></p>
<p>Find z such that <span class="math inline">\(z^{z^{z^\cdots}} = 2\)</span>.</p>
<p><em>Solution:</em> Using the formula, <span class="math display">\[\begin{align}
-W(-\log z) / \log z &amp;= 2 \\
W(-\log z) &amp;= -2\log z \\
-\log z &amp;= -2\log z \mathrm{e}^{-2\log z} \\
\mathrm{e}^{2\log z} &amp;= 2 \\
z &amp;= \sqrt{2}.
\end{align}\]</span></p>
<h2 id="demos">Demos</h2>
<p>The following command evaluates <span class="math inline">\(W_k(1)\)</span> for <span class="math inline">\(k = -4,\ldots,4\)</span>:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode matlab"><code class="sourceCode matlab"><a class="sourceLine" id="cb2-1" title="1">w = lambertw((-<span class="fl">4</span>:<span class="fl">4</span>).&#39;,<span class="fl">1</span>)</a>
<a class="sourceLine" id="cb2-2" title="2">w =</a>
<a class="sourceLine" id="cb2-3" title="3"></a>
<a class="sourceLine" id="cb2-4" title="4">  -<span class="fl">3.1630</span> -<span class="fl">23.4277i</span></a>
<a class="sourceLine" id="cb2-5" title="5">  -<span class="fl">2.8536</span> -<span class="fl">17.1135i</span></a>
<a class="sourceLine" id="cb2-6" title="6">  -<span class="fl">2.4016</span> -<span class="fl">10.7763i</span></a>
<a class="sourceLine" id="cb2-7" title="7">  -<span class="fl">1.5339</span> - <span class="fl">4.3752i</span></a>
<a class="sourceLine" id="cb2-8" title="8">   <span class="fl">0.5671</span></a>
<a class="sourceLine" id="cb2-9" title="9">  -<span class="fl">1.5339</span> + <span class="fl">4.3752i</span></a>
<a class="sourceLine" id="cb2-10" title="10">  -<span class="fl">2.4016</span> +<span class="fl">10.7763i</span></a>
<a class="sourceLine" id="cb2-11" title="11">  -<span class="fl">2.8536</span> +<span class="fl">17.1135i</span></a>
<a class="sourceLine" id="cb2-12" title="12">  -<span class="fl">3.1630</span> +<span class="fl">23.4277i</span></a></code></pre></div>
<p>These values are all solutions of <span class="math inline">\(w\mathrm{e}^w = 1\)</span>. It is easy to verify numerically that they are solutions:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode matlab"><code class="sourceCode matlab"><a class="sourceLine" id="cb3-1" title="1">w.*exp(w)</a>
<a class="sourceLine" id="cb3-2" title="2">ans =</a>
<a class="sourceLine" id="cb3-3" title="3"></a>
<a class="sourceLine" id="cb3-4" title="4">   <span class="fl">1.0000</span> - <span class="fl">0.0000i</span></a>
<a class="sourceLine" id="cb3-5" title="5">   <span class="fl">1.0000</span> - <span class="fl">0.0000i</span></a>
<a class="sourceLine" id="cb3-6" title="6">   <span class="fl">1.0000</span> + <span class="fl">0.0000i</span></a>
<a class="sourceLine" id="cb3-7" title="7">   <span class="fl">1.0000</span></a>
<a class="sourceLine" id="cb3-8" title="8">   <span class="fl">1.0000</span></a>
<a class="sourceLine" id="cb3-9" title="9">   <span class="fl">1.0000</span></a>
<a class="sourceLine" id="cb3-10" title="10">   <span class="fl">1.0000</span> - <span class="fl">0.0000i</span></a>
<a class="sourceLine" id="cb3-11" title="11">   <span class="fl">1.0000</span> + <span class="fl">0.0000i</span></a>
<a class="sourceLine" id="cb3-12" title="12">   <span class="fl">1.0000</span> + <span class="fl">0.0000i</span></a></code></pre></div>
<p>Problem 3 in the previous section mentioned the formula for evaluating iterated exponentiation: <span class="math display">\[z^{z^{z^\cdots}} = \frac{W(-\log z)}{-\log z}.\]</span></p>
<p>For example, set <code>z = 1.3</code>, then its iterated exponentiation is approximately <code>zlim = 1.4710</code>.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode matlab"><code class="sourceCode matlab"><a class="sourceLine" id="cb4-1" title="1">zlim = -lambertw(-log(z))/log(z)</a>
<a class="sourceLine" id="cb4-2" title="2">zlim =</a>
<a class="sourceLine" id="cb4-3" title="3"></a>
<a class="sourceLine" id="cb4-4" title="4">    <span class="fl">1.4710</span></a></code></pre></div>
<p>To verify this, computing <code>z^z^z^...^z</code> through 40 iterations shows that the iterated exponentiation does indeed converge to <code>zlim</code>.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode matlab"><code class="sourceCode matlab"><a class="sourceLine" id="cb5-1" title="1">zz(<span class="fl">1</span>) = z;</a>
<a class="sourceLine" id="cb5-2" title="2">zlim = -lambertw(-log(z))/log(z);</a>
<a class="sourceLine" id="cb5-3" title="3"></a>
<a class="sourceLine" id="cb5-4" title="4">for k = <span class="fl">1</span>:<span class="fl">40</span></a>
<a class="sourceLine" id="cb5-5" title="5">   zz(k+<span class="fl">1</span>) = z^zz(k);</a>
<a class="sourceLine" id="cb5-6" title="6">end</a>
<a class="sourceLine" id="cb5-7" title="7"></a>
<a class="sourceLine" id="cb5-8" title="8">plot(zz,<span class="st">&#39;.-&#39;</span>);</a></code></pre></div>
<div style="float: right">
<p>
<img src="lambertw_02.png" width="300" height="249" alt="">
</p>
</div>
<div style="float: left; width: 18em">
<pre><code>  k    zz     zlim-zz
  1  1.4065   0.065
  2  1.4463   0.025
  3  1.4615   0.0095
  4  1.4673   0.0037
  5  1.4696   0.0014
  6  1.4704   0.00055
  7  1.4708   0.00021
  8  1.4709   8.1e-005
  9  1.4710   3.1e-005
 10  1.4710   1.2e-005
 20  1.4710   8.9e-010
 30  1.4710   6.5e-014
 40  1.4710   2.2e-016</code></pre>
</div>
<div style="clear: both">
 
</div>
<h2 id="test">Test</h2>
<p>Ideally, <code>lambertw(b,z)*exp(lambertw(b,z)) = z</code> for any complex <code>z</code> and any integer branch index <code>b</code>, but this is limited by machine precision. The inversion error <code>|lambertw(b,z)*exp(lambertw(b,z)) - z|</code> is small but worth minding.</p>
<p>Experimentation finds that the error is usually on the order of |z|×10<sup>−16</sup> on the principal branch. This test computes the inversion error over the square [−10,10]×[−10,10] in the complex plane, large enough to characterize the error away from the branch points at z = 0 and −1/e.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode matlab"><code class="sourceCode matlab"><a class="sourceLine" id="cb7-1" title="1">N = <span class="fl">81</span>;    <span class="co">% Use NxN points to sample the complex plane</span></a>
<a class="sourceLine" id="cb7-2" title="2"></a>
<a class="sourceLine" id="cb7-3" title="3">R = <span class="fl">10</span>;    <span class="co">% Sample in the square [-R,R]x[-R,R]</span></a>
<a class="sourceLine" id="cb7-4" title="4">x = linspace(-R,R,N);</a>
<a class="sourceLine" id="cb7-5" title="5">y = linspace(-R,R,N);</a>
<a class="sourceLine" id="cb7-6" title="6">[xx,yy] = meshgrid(x,y);</a>
<a class="sourceLine" id="cb7-7" title="7">z = xx + <span class="fl">1i</span>*yy;</a>
<a class="sourceLine" id="cb7-8" title="8"></a>
<a class="sourceLine" id="cb7-9" title="9">for b = -<span class="fl">4</span>:<span class="fl">4</span></a>
<a class="sourceLine" id="cb7-10" title="10">   w = lambertw(b,z);</a>
<a class="sourceLine" id="cb7-11" title="11">   InvError = abs(w.*exp(w) - z);</a>
<a class="sourceLine" id="cb7-12" title="12">   fprintf(<span class="st">&#39;Largest error for b = %2d:  %.2e\n&#39;</span>,b,max(InvError(:)));</a>
<a class="sourceLine" id="cb7-13" title="13">end</a></code></pre></div>
<pre><code>Largest error for b = -4:  2.51e-014
Largest error for b = -3:  2.39e-014
Largest error for b = -2:  1.39e-014
Largest error for b = -1:  7.94e-015
Largest error for b =  0:  5.40e-015
Largest error for b =  1:  7.94e-015
Largest error for b =  2:  1.39e-014
Largest error for b =  3:  2.39e-014
Largest error for b =  4:  2.51e-014</code></pre>
<h2 id="implementation">Implementation</h2>
<p>The Lambert W function is implemented numerically with approximations from series expansions followed by root-finding. Depending on the desired branch and the proximity to the branch points at z = 0 and −1/e, different series expansions are used as initializations to the root-finder.</p>
<p>As developed in [2], <code>lambertw</code> uses Halley’s method, a fourth-order extension of Newton’s root-finding method. Convergence is very fast, usually requiring fewer than 5 iterations to reach machine accuracy.</p>
<h2 id="references">References</h2>
<p>[1] G. Eisenstein, “Entwicklung von α<sup>α<sup>…</sup></sup>.” J. reine angewandte Math., vol. 28, 1844.<br> [2] R.M. Corless, G.H. Gonnet, D.E.G. Hare, G.J. Jeffery, and D.E. Knuth. <a href="http://www.apmaths.uwo.ca/~rcorless/frames/PAPERS/LambertW/">“On the Lambert W Function.”</a> Advances in Computational Mathematics, vol. 5, 1996.</p>
</div>

<div id="footer">
<p style="text-align:right">
<a href="https://scholar.google.com/citations?user=G8Yjd9AAAAAJ"  target="_blank">Google Scholar</a>
<a href="http://www.linkedin.com/in/pascalgetreuer" target="_blank">LinkedIn</a>
</p>
</div>
</body>
</html>
